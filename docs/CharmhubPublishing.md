# FINOS Legend Image Publishing Job on Charmhub

The ``Publish Legend Images`` [action](../.github/workflows/publish_images.yaml) is configured to run periodically, and can be manually triggered by a project collaborator / owner. The action will check any new FINOS Legend releases created in the [FINOS Legend repository](https://github.com/finos/legend), for each new release the action will pull the FINOS Legend Engine, SDLC, and Studio images defined in that release's ``manifest.json`` file, push them as new resource revisions in Charmhub and make a Charm releases using them.

This action requires the ``CHARMHUB_AUTH`` repository secret (Settings > Secrets > Actions > New repository secret) to be set up in the project in order to push the new charm revisions. The token can be generated by running:

```bash
charmcraft login --export=secrets-legend.auth \
  --charm=finos-legend-engine-k8s --charm=finos-legend-sdlc-k8s \
  --charm=finos-legend-studio-k8s --bundle=finos-legend-bundle \
  --permission=package-manage --permission=package-view-revisions \
  --ttl=1576800
```

This token will have to be updated periodically since it has a certain time to live set.

The ``Publish Legend Images`` action will trigger the ``Create FINOS Legend release branch`` [action](../.github/workflows/publish_images.yaml), which will create a new branch in the repository for the new release. This action can also be manually dispatched. But in order for this action chain to work, the ``GH_TOKEN`` repository secret needs to be added. The token can be [generated](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) with the ``repo, workflow`` scopes.
